/*=================================*/
/* DBMS NAME:	ORACLE Version 12c */
/*=================================*/

ALTER TABLE BOOKS
   DROP CONSTRAINT FK_BOOKS_BOOKS_AUT_AUTHORS;

ALTER TABLE BOOKS
   DROP CONSTRAINT FK_BOOKS_BOOKS_PUB_PUBLISHE;

ALTER TABLE BOOKS_CATEGORIES
   DROP CONSTRAINT FK_BOOKS_CA_BOOKS_CAT_BOOKS;

ALTER TABLE BOOKS_CATEGORIES
   DROP CONSTRAINT FK_BOOKS_CA_BOOKS_CAT_CATEGORI;

ALTER TABLE BOOKS_STUDENTS
   DROP CONSTRAINT FK_BOOKS_ST_BOOKS_STU_BOOKS;

ALTER TABLE BOOKS_STUDENTS
   DROP CONSTRAINT FK_BOOKS_ST_BOOKS_STU_STUDENTS;

ALTER TABLE STUDENTS
   DROP CONSTRAINT FK_STUDENTS_STUDENTS__LIBRARYC;

DROP TABLE AUTHORS CASCADE CONSTRAINTS;

DROP INDEX BOOKS_AUTHORS_FK;

DROP INDEX BOOKS_PUBLISHERS_FK;

DROP TABLE BOOKS CASCADE CONSTRAINTS;

DROP INDEX BOOKS_CATEGORIES2_FK;

DROP INDEX BOOKS_CATEGORIES_FK;

DROP TABLE BOOKS_CATEGORIES CASCADE CONSTRAINTS;

DROP INDEX BOOKS_STUDENTS2_FK;

DROP INDEX BOOKS_STUDENTS_FK;

DROP TABLE BOOKS_STUDENTS CASCADE CONSTRAINTS;

DROP TABLE CATEGORIES CASCADE CONSTRAINTS;

DROP TABLE LIBRARYCARDS CASCADE CONSTRAINTS;

DROP TABLE PUBLISHERS CASCADE CONSTRAINTS;

DROP INDEX STUDENTS_CARDS_FK;

DROP TABLE STUDENTS CASCADE CONSTRAINTS;

/*==============================================================*/
/* TABLE: AUTHORS                                               */
/*==============================================================*/
CREATE TABLE AUTHORS (
   AUTHORID             VARCHAR2(10)          NOT NULL,
   AUTHORFIRSTNAME      VARCHAR2(50),
   AUTHORLASTNAME       VARCHAR2(50),
   AUTHORCOUNTRY        VARCHAR2(30),
   CONSTRAINT PK_AUTHORS PRIMARY KEY (AUTHORID)
);

/*==============================================================*/
/* TABLE: BOOKS                                                 */
/*==============================================================*/
CREATE TABLE BOOKS (
   ISBN                 VARCHAR2(13)          NOT NULL,
   AUTHORID             VARCHAR2(10)          NOT NULL,
   PUBLISHERID          VARCHAR2(10)          NOT NULL,
   BOOKTITLE            VARCHAR2(50),
   BOOKPUBLISHDATE      DATE,
   BOOKQUANTITY         SMALLINT,
   BOOKPRICE            REAL,
   CONSTRAINT PK_BOOKS PRIMARY KEY (ISBN)
);

/*==============================================================*/
/* INDEX: BOOKS_PUBLISHERS_FK                                   */
/*==============================================================*/
CREATE INDEX BOOKS_PUBLISHERS_FK ON BOOKS (
   PUBLISHERID ASC
);

/*==============================================================*/
/* INDEX: BOOKS_AUTHORS_FK                                      */
/*==============================================================*/
CREATE INDEX BOOKS_AUTHORS_FK ON BOOKS (
   AUTHORID ASC
);

/*==============================================================*/
/* TABLE: BOOKS_CATEGORIES                                      */
/*==============================================================*/
CREATE TABLE BOOKS_CATEGORIES (
   ISBN                 VARCHAR2(13)          NOT NULL,
   CATEGORYID           VARCHAR2(5)           NOT NULL,
   CONSTRAINT PK_BOOKS_CATEGORIES PRIMARY KEY (ISBN, CATEGORYID)
);

/*==============================================================*/
/* INDEX: BOOKS_CATEGORIES_FK                                   */
/*==============================================================*/
CREATE INDEX BOOKS_CATEGORIES_FK ON BOOKS_CATEGORIES (
   ISBN ASC
);

/*==============================================================*/
/* INDEX: BOOKS_CATEGORIES2_FK                                  */
/*==============================================================*/
CREATE INDEX BOOKS_CATEGORIES2_FK ON BOOKS_CATEGORIES (
   CATEGORYID ASC
);

/*==============================================================*/
/* TABLE: BOOKS_STUDENTS                                        */
/*==============================================================*/
CREATE TABLE BOOKS_STUDENTS (
   ISBN                 VARCHAR2(13)          NOT NULL,
   STDID                VARCHAR2(9)           NOT NULL,
   BOOKBORROWINGDATE    DATE,
   BOOKDELIVERYDATE     DATE,
   CONSTRAINT PK_BOOKS_STUDENTS PRIMARY KEY (ISBN, STDID)
);

/*==============================================================*/
/* INDEX: BOOKS_STUDENTS_FK                                     */
/*==============================================================*/
CREATE INDEX BOOKS_STUDENTS_FK ON BOOKS_STUDENTS (
   ISBN ASC
);

/*==============================================================*/
/* INDEX: BOOKS_STUDENTS2_FK                                    */
/*==============================================================*/
CREATE INDEX BOOKS_STUDENTS2_FK ON BOOKS_STUDENTS (
   STDID ASC
);

/*==============================================================*/
/* TABLE: CATEGORIES                                            */
/*==============================================================*/
CREATE TABLE CATEGORIES (
   CATEGORYID           VARCHAR2(5)           NOT NULL,
   CATEGORYNAME         VARCHAR2(40),
   CONSTRAINT PK_CATEGORIES PRIMARY KEY (CATEGORYID)
);

/*==============================================================*/
/* TABLE: LIBRARYCARDS                                          */
/*==============================================================*/
CREATE TABLE LIBRARYCARDS (
   CARDNO               VARCHAR2(10)          NOT NULL,
   CARDEXPDATE          DATE                  NOT NULL,
   CONSTRAINT PK_LIBRARYCARDS PRIMARY KEY (CARDNO)
);

/*==============================================================*/
/* TABLE: PUBLISHERS                                            */
/*==============================================================*/
CREATE TABLE PUBLISHERS (
   PUBLISHERID          VARCHAR2(10)          NOT NULL,
   PUBLISHERFULLNAME    VARCHAR2(50),
   PUBLISHERADDRESS     VARCHAR2(100),
   CONSTRAINT PK_PUBLISHERS PRIMARY KEY (PUBLISHERID)
);

/*==============================================================*/
/* TABLE: STUDENTS                                              */
/*==============================================================*/
CREATE TABLE STUDENTS (
   STDID                VARCHAR2(9)           NOT NULL,
   CARDNO               VARCHAR2(10)          NOT NULL,
   STDFIRSNAME          VARCHAR2(50),
   STDLASTNAME          VARCHAR2(50),
   STDPHONENO           VARCHAR2(12),
   STDMAIL              VARCHAR2(50),
   STDADDRESS           VARCHAR2(100),
   STDPOINT             NUMBER(3,0),
   CONSTRAINT PK_STUDENTS PRIMARY KEY (STDID)
);

/*==============================================================*/
/* INDEX: STUDENTS_CARDS_FK                                     */
/*==============================================================*/
CREATE INDEX STUDENTS_CARDS_FK ON STUDENTS (
   CARDNO ASC
);

ALTER TABLE BOOKS
   ADD CONSTRAINT FK_BOOKS_BOOKS_AUT_AUTHORS FOREIGN KEY (AUTHORID)
      REFERENCES AUTHORS (AUTHORID);

ALTER TABLE BOOKS
   ADD CONSTRAINT FK_BOOKS_BOOKS_PUB_PUBLISHE FOREIGN KEY (PUBLISHERID)
      REFERENCES PUBLISHERS (PUBLISHERID);

ALTER TABLE BOOKS_CATEGORIES
   ADD CONSTRAINT FK_BOOKS_CA_BOOKS_CAT_BOOKS FOREIGN KEY (ISBN)
      REFERENCES BOOKS (ISBN);

ALTER TABLE BOOKS_CATEGORIES
   ADD CONSTRAINT FK_BOOKS_CA_BOOKS_CAT_CATEGORI FOREIGN KEY (CATEGORYID)
      REFERENCES CATEGORIES (CATEGORYID);

ALTER TABLE BOOKS_STUDENTS
   ADD CONSTRAINT FK_BOOKS_ST_BOOKS_STU_BOOKS FOREIGN KEY (ISBN)
      REFERENCES BOOKS (ISBN);

ALTER TABLE BOOKS_STUDENTS
   ADD CONSTRAINT FK_BOOKS_ST_BOOKS_STU_STUDENTS FOREIGN KEY (STDID)
      REFERENCES STUDENTS (STDID);

ALTER TABLE STUDENTS
   ADD CONSTRAINT FK_STUDENTS_STUDENTS__LIBRARYC FOREIGN KEY (CARDNO)
      REFERENCES LIBRARYCARDS (CARDNO);

INSERT INTO AUTHORS (AUTHORID, AUTHORFIRSTNAME, AUTHORLASTNAME, AUTHORCOUNTRY) 
VALUES ('A01', 'J.K.', 'Rowling', 'United Kingdom');
INSERT INTO AUTHORS (AUTHORID, AUTHORFIRSTNAME, AUTHORLASTNAME, AUTHORCOUNTRY) 
VALUES ('A02', 'Stephen', 'King', 'United States');
INSERT INTO AUTHORS (AUTHORID, AUTHORFIRSTNAME, AUTHORLASTNAME, AUTHORCOUNTRY) 
VALUES ('A03', 'Harper', 'Lee', 'United States');
INSERT INTO AUTHORS (AUTHORID, AUTHORFIRSTNAME, AUTHORLASTNAME, AUTHORCOUNTRY) 
VALUES ('A04', 'Gabriel', 'Garcia Marquez', 'Colombia');
INSERT INTO AUTHORS (AUTHORID, AUTHORFIRSTNAME, AUTHORLASTNAME, AUTHORCOUNTRY) 
VALUES ('A05', 'Margaret', 'Atwood', 'Canada');
INSERT INTO AUTHORS (AUTHORID, AUTHORFIRSTNAME, AUTHORLASTNAME, AUTHORCOUNTRY) 
VALUES ('A06', 'Chinua', 'Achebe', 'Nigeria');
INSERT INTO AUTHORS (AUTHORID, AUTHORFIRSTNAME, AUTHORLASTNAME, AUTHORCOUNTRY) 
VALUES ('A07', 'Toni', 'Morrison', 'United States');
INSERT INTO AUTHORS (AUTHORID, AUTHORFIRSTNAME, AUTHORLASTNAME, AUTHORCOUNTRY) 
VALUES ('A08', 'Arundhati', 'Roy', 'India');
INSERT INTO AUTHORS (AUTHORID, AUTHORFIRSTNAME, AUTHORLASTNAME, AUTHORCOUNTRY) 
VALUES ('A09', 'Khaled', 'Hosseini', 'Afghanistan');
INSERT INTO AUTHORS (AUTHORID, AUTHORFIRSTNAME, AUTHORLASTNAME, AUTHORCOUNTRY) 
VALUES ('A10', 'Isabel', 'Allende', 'Chile');

INSERT INTO PUBLISHERS (PUBLISHERID, PUBLISHERFULLNAME, PUBLISHERADDRESS)
VALUES ('PUB01', 'ABC Publications', '123 Main Street');
INSERT INTO PUBLISHERS (PUBLISHERID, PUBLISHERFULLNAME, PUBLISHERADDRESS)
VALUES ('PUB02', 'XYZ Books', '456 Elm Avenue');
INSERT INTO PUBLISHERS (PUBLISHERID, PUBLISHERFULLNAME, PUBLISHERADDRESS)
VALUES ('PUB03', 'Bookworm Publishing', '789 Oak Lane');
INSERT INTO PUBLISHERS (PUBLISHERID, PUBLISHERFULLNAME, PUBLISHERADDRESS)
VALUES ('PUB04', 'Library Press', '987 Maple Road');
INSERT INTO PUBLISHERS (PUBLISHERID, PUBLISHERFULLNAME, PUBLISHERADDRESS)
VALUES ('PUB05', 'Global Books Ltd.', '555 Pine Street');
INSERT INTO PUBLISHERS (PUBLISHERID, PUBLISHERFULLNAME, PUBLISHERADDRESS)
VALUES ('PUB06', 'Readers Publishing House', '321 Cedar Avenue');
INSERT INTO PUBLISHERS (PUBLISHERID, PUBLISHERFULLNAME, PUBLISHERADDRESS)
VALUES ('PUB07', 'Book Haven', '222 Oak Street');
INSERT INTO PUBLISHERS (PUBLISHERID, PUBLISHERFULLNAME, PUBLISHERADDRESS)
VALUES ('PUB08', 'Printed Words Publishers', '444 Elm Road');
INSERT INTO PUBLISHERS (PUBLISHERID, PUBLISHERFULLNAME, PUBLISHERADDRESS)
VALUES ('PUB09', 'Literary Works Ltd.', '888 Pine Avenue');
INSERT INTO PUBLISHERS (PUBLISHERID, PUBLISHERFULLNAME, PUBLISHERADDRESS)
VALUES ('PUB10', 'Inkwell Publishing', '666 Maple Lane');

INSERT INTO BOOKS (ISBN, AUTHORID, PUBLISHERID, BOOKTITLE, BOOKPUBLISHDATE, BOOKQUANTITY, BOOKPRICE) 
VALUES ('9780545010221', (SELECT AUTHORID FROM AUTHORS WHERE AUTHORID = 'A01'), (SELECT PUBLISHERID FROM PUBLISHERS WHERE PUBLISHERID = 'PUB01'), 'Harry Potter and the Deathly Hallows', TO_DATE('2007/07/21', 'YYYY/MM/DD'), 100, 19.99);
INSERT INTO BOOKS (ISBN, AUTHORID, PUBLISHERID, BOOKTITLE, BOOKPUBLISHDATE, BOOKQUANTITY, BOOKPRICE) 
VALUES ('9781501142970', (SELECT AUTHORID FROM AUTHORS WHERE AUTHORID = 'A02'), (SELECT PUBLISHERID FROM PUBLISHERS WHERE PUBLISHERID = 'PUB02'), 'The Outsider', TO_DATE('2018/05/22', 'YYYY/MM/DD'), 50, 18.99);
INSERT INTO BOOKS (ISBN, AUTHORID, PUBLISHERID, BOOKTITLE, BOOKPUBLISHDATE, BOOKQUANTITY, BOOKPRICE) 
VALUES ('9780060935467', (SELECT AUTHORID FROM AUTHORS WHERE AUTHORID = 'A03'), (SELECT PUBLISHERID FROM PUBLISHERS WHERE PUBLISHERID = 'PUB03'), 'To Kill a Mockingbird', TO_DATE('1960/07/11', 'YYYY/MM/DD'), 200, 10.99);
INSERT INTO BOOKS (ISBN, AUTHORID, PUBLISHERID, BOOKTITLE, BOOKPUBLISHDATE, BOOKQUANTITY, BOOKPRICE) 
VALUES ('9780307389733', (SELECT AUTHORID FROM AUTHORS WHERE AUTHORID = 'A04'), (SELECT PUBLISHERID FROM PUBLISHERS WHERE PUBLISHERID = 'PUB04'), 'One Hundred Years of Solitude', TO_DATE('1967/05/30', 'YYYY/MM/DD'), 75, 14.99);
INSERT INTO BOOKS (ISBN, AUTHORID, PUBLISHERID, BOOKTITLE, BOOKPUBLISHDATE, BOOKQUANTITY, BOOKPRICE) 
VALUES ('9780385490818', (SELECT AUTHORID FROM AUTHORS WHERE AUTHORID = 'A05'), (SELECT PUBLISHERID FROM PUBLISHERS WHERE PUBLISHERID = 'PUB05'), 'The Handmaid''s Tale', TO_DATE('1985/06/14', 'YYYY/MM/DD'), 150, 12.99);
INSERT INTO BOOKS (ISBN, AUTHORID, PUBLISHERID, BOOKTITLE, BOOKPUBLISHDATE, BOOKQUANTITY, BOOKPRICE) 
VALUES ('9780807610664', (SELECT AUTHORID FROM AUTHORS WHERE AUTHORID = 'A06'), (SELECT PUBLISHERID FROM PUBLISHERS WHERE PUBLISHERID = 'PUB06'), 'Things Fall Apart', TO_DATE('1958/06/17', 'YYYY/MM/DD'), 125, 8.99);
INSERT INTO BOOKS (ISBN, AUTHORID, PUBLISHERID, BOOKTITLE, BOOKPUBLISHDATE, BOOKQUANTITY, BOOKPRICE) 
VALUES ('9781400033423', (SELECT AUTHORID FROM AUTHORS WHERE AUTHORID = 'A07'), (SELECT PUBLISHERID FROM PUBLISHERS WHERE PUBLISHERID = 'PUB07'), 'Beloved', TO_DATE('1987/09/02', 'YYYY/MM/DD'), 100, 11.99);
INSERT INTO BOOKS (ISBN, AUTHORID, PUBLISHERID, BOOKTITLE, BOOKPUBLISHDATE, BOOKQUANTITY, BOOKPRICE) 
VALUES ('9780679745587', (SELECT AUTHORID FROM AUTHORS WHERE AUTHORID = 'A08'), (SELECT PUBLISHERID FROM PUBLISHERS WHERE PUBLISHERID = 'PUB08'), 'The God of Small Things', TO_DATE('1997/04/04', 'YYYY/MM/DD'), 80, 9.99);
INSERT INTO BOOKS (ISBN, AUTHORID, PUBLISHERID, BOOKTITLE, BOOKPUBLISHDATE, BOOKQUANTITY, BOOKPRICE) 
VALUES ('9781594480003', (SELECT AUTHORID FROM AUTHORS WHERE AUTHORID = 'A09'), (SELECT PUBLISHERID FROM PUBLISHERS WHERE PUBLISHERID = 'PUB09'), 'The Kite Runner', TO_DATE('2003/05/29', 'YYYY/MM/DD'), 90, 13.99);
INSERT INTO BOOKS (ISBN, AUTHORID, PUBLISHERID, BOOKTITLE, BOOKPUBLISHDATE, BOOKQUANTITY, BOOKPRICE) 
VALUES ('9780007548699', (SELECT AUTHORID FROM AUTHORS WHERE AUTHORID = 'A10'), (SELECT PUBLISHERID FROM PUBLISHERS WHERE PUBLISHERID = 'PUB10'), 'The House of the Spirits', TO_DATE('1982/06/22', 'YYYY/MM/DD'), 70, 10.99);

INSERT INTO CATEGORIES (CATEGORYID, CATEGORYNAME) 
VALUES ('C01', 'Fantasy');
INSERT INTO CATEGORIES (CATEGORYID, CATEGORYNAME) 
VALUES ('C02', 'Horror');
INSERT INTO CATEGORIES (CATEGORYID, CATEGORYNAME) 
VALUES ('C03', 'Mystery');
INSERT INTO CATEGORIES (CATEGORYID, CATEGORYNAME) 
VALUES ('C04', 'Romance');
INSERT INTO CATEGORIES (CATEGORYID, CATEGORYNAME) 
VALUES ('C05', 'Science Fiction');
INSERT INTO CATEGORIES (CATEGORYID, CATEGORYNAME) 
VALUES ('C06', 'Thriller');
INSERT INTO CATEGORIES (CATEGORYID, CATEGORYNAME) 
VALUES ('C07', 'Historical Fiction');
INSERT INTO CATEGORIES (CATEGORYID, CATEGORYNAME) 
VALUES ('C08', 'Biography');
INSERT INTO CATEGORIES (CATEGORYID, CATEGORYNAME) 
VALUES ('C09', 'Young Adult');
INSERT INTO CATEGORIES (CATEGORYID, CATEGORYNAME) 
VALUES ('C10', 'Self-Help');

INSERT INTO BOOKS_CATEGORIES (ISBN, CATEGORYID)
VALUES ('9780545010221', 'C01');
INSERT INTO BOOKS_CATEGORIES (ISBN, CATEGORYID)
VALUES ('9781501142970', 'C02');
INSERT INTO BOOKS_CATEGORIES (ISBN, CATEGORYID)
VALUES ('9780060935467', 'C03');
INSERT INTO BOOKS_CATEGORIES (ISBN, CATEGORYID)
VALUES ('9780307389733', 'C04');
INSERT INTO BOOKS_CATEGORIES (ISBN, CATEGORYID)
VALUES ('9780385490818', 'C05');
INSERT INTO BOOKS_CATEGORIES (ISBN, CATEGORYID)
VALUES ('9780807610664', 'C06');
INSERT INTO BOOKS_CATEGORIES (ISBN, CATEGORYID)
VALUES ('9781400033423', 'C07');
INSERT INTO BOOKS_CATEGORIES (ISBN, CATEGORYID)
VALUES ('9780679745587', 'C08');
INSERT INTO BOOKS_CATEGORIES (ISBN, CATEGORYID)
VALUES ('9781594480003', 'C09');
INSERT INTO BOOKS_CATEGORIES (ISBN, CATEGORYID)
VALUES ('9780007548699', 'C10');

INSERT INTO LIBRARYCARDS (CARDNO, CARDEXPDATE)
VALUES ('1234567890', TO_DATE('2023-05-31', 'YYYY-MM-DD'));
INSERT INTO LIBRARYCARDS (CARDNO, CARDEXPDATE)
VALUES ('9876543210', TO_DATE('2023-08-15', 'YYYY-MM-DD'));
INSERT INTO LIBRARYCARDS (CARDNO, CARDEXPDATE)
VALUES ('2468135790', TO_DATE('2023-06-30', 'YYYY-MM-DD'));
INSERT INTO LIBRARYCARDS (CARDNO, CARDEXPDATE)
VALUES ('1357924680', TO_DATE('2023-09-30', 'YYYY-MM-DD'));
INSERT INTO LIBRARYCARDS (CARDNO, CARDEXPDATE)
VALUES ('0987654321', TO_DATE('2023-07-31', 'YYYY-MM-DD'));
INSERT INTO LIBRARYCARDS (CARDNO, CARDEXPDATE)
VALUES ('5678901234', TO_DATE('2023-10-15', 'YYYY-MM-DD'));
INSERT INTO LIBRARYCARDS (CARDNO, CARDEXPDATE)
VALUES ('4321098765', TO_DATE('2023-08-31', 'YYYY-MM-DD'));
INSERT INTO LIBRARYCARDS (CARDNO, CARDEXPDATE)
VALUES ('3872573213', TO_DATE('2023-12-31', 'YYYY-MM-DD'));
INSERT INTO LIBRARYCARDS (CARDNO, CARDEXPDATE)
VALUES ('7890123456', TO_DATE('2023-07-15', 'YYYY-MM-DD'));
INSERT INTO LIBRARYCARDS (CARDNO, CARDEXPDATE)
VALUES ('6543210987', TO_DATE('2023-11-30', 'YYYY-MM-DD'));

INSERT INTO STUDENTS (STDID, CARDNO, STDFIRSNAME, STDLASTNAME, STDPHONENO, STDMAIL, STDADDRESS, STDPOINT)
VALUES ('S0001', (SELECT CARDNO FROM LIBRARYCARDS WHERE CARDNO = '1234567890'), 'John', 'Doe', '123-456-7890', 'john.doe@example.com', '123 Main St', 80);
INSERT INTO STUDENTS (STDID, CARDNO, STDFIRSNAME, STDLASTNAME, STDPHONENO, STDMAIL, STDADDRESS, STDPOINT)
VALUES ('S0002', (SELECT CARDNO FROM LIBRARYCARDS WHERE CARDNO = '9876543210'), 'Jane', 'Smith', '987-654-3210', 'jane.smith@example.com', '456 Elm St', 75);
INSERT INTO STUDENTS (STDID, CARDNO, STDFIRSNAME, STDLASTNAME, STDPHONENO, STDMAIL, STDADDRESS, STDPOINT)
VALUES ('S0003', (SELECT CARDNO FROM LIBRARYCARDS WHERE CARDNO = '2468135790'), 'Michael', 'Johnson', '246-813-5790', 'michael.johnson@example.com', '789 Oak St', 90);
INSERT INTO STUDENTS (STDID, CARDNO, STDFIRSNAME, STDLASTNAME, STDPHONENO, STDMAIL, STDADDRESS, STDPOINT)
VALUES ('S0004', (SELECT CARDNO FROM LIBRARYCARDS WHERE CARDNO = '1357924680'), 'Emily', 'Williams', '135-792-4680', 'emily.williams@example.com', '321 Pine St', 85);
INSERT INTO STUDENTS (STDID, CARDNO, STDFIRSNAME, STDLASTNAME, STDPHONENO, STDMAIL, STDADDRESS, STDPOINT)
VALUES ('S0005', (SELECT CARDNO FROM LIBRARYCARDS WHERE CARDNO = '0987654321'), 'David', 'Brown', '098-765-4321', 'david.brown@example.com', '654 Cedar St', 70);
INSERT INTO STUDENTS (STDID, CARDNO, STDFIRSNAME, STDLASTNAME, STDPHONENO, STDMAIL, STDADDRESS, STDPOINT)
VALUES ('S0006', (SELECT CARDNO FROM LIBRARYCARDS WHERE CARDNO = '5678901234'), 'Sarah', 'Miller', '567-890-1234', 'sarah.miller@example.com', '987 Maple St', 95);
INSERT INTO STUDENTS (STDID, CARDNO, STDFIRSNAME, STDLASTNAME, STDPHONENO, STDMAIL, STDADDRESS, STDPOINT)
VALUES ('S0007', (SELECT CARDNO FROM LIBRARYCARDS WHERE CARDNO = '4321098765'), 'Matthew', 'Wilson', '432-109-8765', 'matthew.wilson@example.com', '654 Oak St', 60);
INSERT INTO STUDENTS (STDID, CARDNO, STDFIRSNAME, STDLASTNAME, STDPHONENO, STDMAIL, STDADDRESS, STDPOINT)
VALUES ('S0008', (SELECT CARDNO FROM LIBRARYCARDS WHERE CARDNO = '3872573213'), 'Olivia', 'Taylor', '387-257-3213', 'olivia.taylor@example.com', '321 Maple St', 80);
INSERT INTO STUDENTS (STDID, CARDNO, STDFIRSNAME, STDLASTNAME, STDPHONENO, STDMAIL, STDADDRESS, STDPOINT)
VALUES ('S0009', (SELECT CARDNO FROM LIBRARYCARDS WHERE CARDNO = '7890123456'), 'Daniel', 'Anderson', '789-012-3456', 'daniel.anderson@example.com', '654 Elm St', 85);
INSERT INTO STUDENTS (STDID, CARDNO, STDFIRSNAME, STDLASTNAME, STDPHONENO, STDMAIL, STDADDRESS, STDPOINT)
VALUES ('S0010', (SELECT CARDNO FROM LIBRARYCARDS WHERE CARDNO = '6543210987'), 'James', 'Roberts', '444-777-8888', 'james.roberts@example.com', '123 Oak St, City', 50);

INSERT INTO BOOKS_STUDENTS (ISBN, STDID, BOOKBORROWINGDATE, BOOKDELIVERYDATE)
VALUES ('9780545010221', 'S0001', TO_DATE('2023/05/01', 'YYYY/MM/DD'), TO_DATE('2023/05/15', 'YYYY/MM/DD'));
INSERT INTO BOOKS_STUDENTS (ISBN, STDID, BOOKBORROWINGDATE, BOOKDELIVERYDATE)
VALUES ('9781501142970', 'S0002', TO_DATE('2023/04/20', 'YYYY/MM/DD'), TO_DATE('2023/05/10', 'YYYY/MM/DD'));
INSERT INTO BOOKS_STUDENTS (ISBN, STDID, BOOKBORROWINGDATE, BOOKDELIVERYDATE)
VALUES ('9780060935467', 'S0003', TO_DATE('2023/05/03', 'YYYY/MM/DD'), TO_DATE('2023/05/17', 'YYYY/MM/DD'));
INSERT INTO BOOKS_STUDENTS (ISBN, STDID, BOOKBORROWINGDATE, BOOKDELIVERYDATE)
VALUES ('9780307389733', 'S0004', TO_DATE('2023/04/25', 'YYYY/MM/DD'), TO_DATE('2023/05/08', 'YYYY/MM/DD'));
INSERT INTO BOOKS_STUDENTS (ISBN, STDID, BOOKBORROWINGDATE, BOOKDELIVERYDATE)
VALUES ('9780385490818', 'S0005', TO_DATE('2023/05/10', 'YYYY/MM/DD'), TO_DATE('2023/05/24', 'YYYY/MM/DD'));
INSERT INTO BOOKS_STUDENTS (ISBN, STDID, BOOKBORROWINGDATE, BOOKDELIVERYDATE)
VALUES ('9780807610664', 'S0006', TO_DATE('2023/04/28', 'YYYY/MM/DD'), TO_DATE('2023/05/12', 'YYYY/MM/DD'));
INSERT INTO BOOKS_STUDENTS (ISBN, STDID, BOOKBORROWINGDATE, BOOKDELIVERYDATE)
VALUES ('9781400033423', 'S0007', TO_DATE('2023/05/05', 'YYYY/MM/DD'), TO_DATE('2023/05/19', 'YYYY/MM/DD'));
INSERT INTO BOOKS_STUDENTS (ISBN, STDID, BOOKBORROWINGDATE, BOOKDELIVERYDATE)
VALUES ('9780679745587', 'S0008', TO_DATE('2023/05/08', 'YYYY/MM/DD'), TO_DATE('2023/05/22', 'YYYY/MM/DD'));
INSERT INTO BOOKS_STUDENTS (ISBN, STDID, BOOKBORROWINGDATE, BOOKDELIVERYDATE)
VALUES ('9781594480003', 'S0009', TO_DATE('2023/05/12', 'YYYY/MM/DD'), TO_DATE('2023/05/26', 'YYYY/MM/DD'));
INSERT INTO BOOKS_STUDENTS (ISBN, STDID, BOOKBORROWINGDATE, BOOKDELIVERYDATE)
VALUES ('9780007548699', 'S0010', TO_DATE('2023/05/15', 'YYYY/MM/DD'), TO_DATE('2023/05/29', 'YYYY/MM/DD'));


/* TASK 1 */
DECLARE
  CURSOR c_books IS
    SELECT * FROM BOOKS;
 
  TYPE t_books IS TABLE OF c_books%ROWTYPE;
  l_books t_books;
 
BEGIN
  OPEN c_books;
  FETCH c_books BULK COLLECT INTO l_books;
  CLOSE c_books;
 
  FOR i IN 1..l_books.COUNT LOOP
    l_books(i).BOOKTITLE := 'New Title ' || i;
  END LOOP;
 
  FORALL i IN 1..l_books.COUNT
    UPDATE BOOKS
    SET BOOKTITLE = l_books(i).BOOKTITLE
    WHERE ISBN = l_books(i).ISBN;
 
  COMMIT;
END;
/

SELECT * FROM BOOKS;


/* TASK 2 */
CREATE OR REPLACE TRIGGER trg_modify_book_title
BEFORE INSERT ON BOOKS
FOR EACH ROW
BEGIN
  :NEW.BOOKTITLE := 'Alias Grace (Trigger Modified Title)';
END;
/
 
INSERT INTO BOOKS (ISBN, AUTHORID, PUBLISHERID, BOOKTITLE, BOOKPUBLISHDATE, BOOKQUANTITY, BOOKPRICE)
VALUES ('9780771008351', (SELECT AUTHORID FROM AUTHORS WHERE AUTHORID = 'A05'), (SELECT PUBLISHERID FROM PUBLISHERS WHERE PUBLISHERID = 'PUB05'), 'Original Title', TO_DATE('1997/02/27', 'YYYY/MM/DD'), 95, 8.99);
 
SELECT * FROM BOOKS;


/* TASK 3 */
CREATE OR REPLACE FUNCTION print_book_price(p_isbn IN VARCHAR2) RETURN REAL IS
  l_price REAL;
BEGIN
  SELECT BOOKPRICE INTO l_price
  FROM BOOKS
  WHERE ISBN = p_isbn;
 
  RETURN l_price;
END;
/
 
CREATE OR REPLACE PROCEDURE display_book_details(p_isbn IN VARCHAR2) IS
  l_isbn VARCHAR2(13);
  l_title VARCHAR2(50);
  l_publishdate DATE;
  l_price REAL;
BEGIN
  SELECT ISBN, BOOKTITLE, BOOKPUBLISHDATE, BOOKPRICE INTO l_isbn, l_title, l_publishdate, l_price
  FROM BOOKS
  WHERE ISBN = p_isbn;
 
  DBMS_OUTPUT.PUT_LINE('ISBN: ' || l_isbn);
  DBMS_OUTPUT.PUT_LINE('Title: ' || l_title);
  DBMS_OUTPUT.PUT_LINE('Publish Date: ' || l_publishdate);
  DBMS_OUTPUT.PUT_LINE('Price: ' || l_price);
END;
/
 
WITH
  book_data AS (
    SELECT '9780545010221' AS ISBN, print_book_price('9780545010221') AS book_price FROM DUAL
  )
SELECT ISBN, book_price FROM book_data;
 
BEGIN
  display_book_details('9780545010221');
END;
/


/* TASK 4 */
DECLARE
  l_sql_stmt VARCHAR2(500);
  l_result NUMBER;
 
BEGIN
  l_sql_stmt := 'SELECT COUNT(*) FROM BOOKS WHERE AUTHORID = :author_id';
  EXECUTE IMMEDIATE l_sql_stmt INTO l_result USING 'A01';
  DBMS_OUTPUT.PUT_LINE('Number of books by author: ' || l_result);
 
  l_sql_stmt := 'CREATE OR REPLACE PROCEDURE dynamic_procedure IS
                  l_book_count NUMBER;
                BEGIN
                  SELECT COUNT(*) INTO l_book_count FROM BOOKS;
                  DBMS_OUTPUT.PUT_LINE(''Total books: '' || l_book_count);
                  DBMS_OUTPUT.PUT_LINE(''Hello from Dynamic PL/SQL!'');
                END;';
  EXECUTE IMMEDIATE l_sql_stmt;
 
  EXECUTE IMMEDIATE 'BEGIN dynamic_procedure; END;';
 
  EXECUTE IMMEDIATE 'DROP PROCEDURE dynamic_procedure';
END;
/
